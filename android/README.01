# New Circle Android Internals Training Day 1
# by Gil from Vancouver Canada

Some Theory

 developer.android.com/training/index.html
 developer.android.com/guide/components/processes-and-threads.html
 www.thenewcircle.com

Android Device Access
 $ adb shell

SysFs
 $ ls /sys/class/backlight/
 $ cat brightness
 $ ls /sys/class/timed_output/vibrator/
ToDo! Get into details of Sysfs implementation

DevFs
 $ echo hola > /dev/null
 $ ls /dev/ | grep gps
 $ file /dev/ttyTHS1

Audio
 $ ls /lib/linux-sound-base/
ToDo! Include /lib/linux* directory to Audio Workshop

Linux Kernel
Forked from mainline
Busybox
User Space Vs Kernel Space
 $ ls /system/bin/tmp
Idea! Practice with Tmpfs / Ramdisk / Ram Disk
 $ ls /data/system/users/ #

 $ id
 $ ps -aux | grep eclipse
Each Android Application is a new user
Data Vs System Partitions
When you flash your device in the factory there are 2 images:
 - system.img
 - userdata.im
 $ ls /system/
 $ ls /system/lib
System is a read-only partition
Applications are put into /data
System expands content under /data partition

 $ cd /data/data/com.google.android.gm/databases
 $ ls -l | grep gm
 $ ps | grep gm
 $ # Look at users, change and see behaviour
 $ su 70

? Who takes care of creating a user?
InstallDaemon by Zygote

 $ ps |  grep installd
 $ ls /dev | grep gps
 $ ps | grep system

2 ways to access hardware

 1. Using somebody else, another service

 Location Service / GPS / Binder
 $ top -t | grep system_server
 Mean to communicate between Application to Services? Binder
 Vibrator
 $ ls ~/aosp/frameworks/base/services/core/java/com/android/server/VibratorService.java
 $ ls /sys/class/timed_output/vibrator
 $ cat /home/student/aosp/frameworks/base/services/core/jni/com_android_server_VibratorService.cpp
 $ nano android/server/LocationManagerService.java
 Talk about permissions
 How do we ask access for permissions? Android Manifest
 HelloWorld application lookin to get Location Services
 Added under Android Manifest as ACCESS_FINE_LOCATION
 $ ls /data/system/packages.xml
 $ adb pull /data/system/packages.xml
 Looked at the line where HelloWorld application
 Package Manager Service and Location Services are both under System Service
 $ adb push ...
 $ adb logcat
 $ ls ~/aosp/framework/base/location/java/android/location/ILocationListener.aidl

 2. Through belonging to a group Id
 $ ls /dev/socket
 Inet group

 There are 2 Securities Checks
 - Kernel Level Security Check
 - Location Service in Java through XML file

 2. Binder
 $ ls /dev/binder

ToDo! AIDL Android Interface Definition Language

Other Information
http://users.encs.concordia.ca/~clark/papers/2012_spsm.pdf

# End of File
